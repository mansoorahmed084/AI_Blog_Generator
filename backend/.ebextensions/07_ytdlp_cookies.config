container_commands:
  01_write_ytdlp_cookies:
    command: |
      TARGET_DIR="/var/app/current"
      if [ -d "/var/app/ondeck" ]; then
        TARGET_DIR="/var/app/ondeck"
      fi
      if [ -n "$YTDLP_COOKIES_S3_BUCKET" ] && [ -n "$YTDLP_COOKIES_S3_KEY" ]; then
        aws s3 cp "s3://$YTDLP_COOKIES_S3_BUCKET/$YTDLP_COOKIES_S3_KEY" "$TARGET_DIR/cookies.txt"
        chown webapp:webapp "$TARGET_DIR/cookies.txt" || true
        chmod 600 "$TARGET_DIR/cookies.txt" || true
      elif [ -n "$YTDLP_COOKIES_B64" ]; then
        echo "$YTDLP_COOKIES_B64" | base64 -d > "$TARGET_DIR/cookies.txt"
        chown webapp:webapp "$TARGET_DIR/cookies.txt" || true
        chmod 600 "$TARGET_DIR/cookies.txt" || true
      fi
